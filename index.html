<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ä¾£é£è¡Œæ£‹æ¸¸æˆ - 81æ ¼æµªæ¼«ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'ZCOOL XiaoWei', 'Microsoft YaHei', Arial, sans-serif;
            overflow: hidden;
            position: relative;
            height: 100vh;
            background: linear-gradient(135deg, #ff9eb5 0%, #fad0c4 100%);
        }
        @keyframes fallingPetals {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0.7; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        .petal {
            position: fixed;
            top: 0;
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23ff9eb5" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: -1;
            pointer-events: none;
            animation: fallingPetals 15s linear infinite;
        }
        .scroll-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 200%;
            height: 100vh;
            z-index: -2;
            animation: scrollBackground 20s linear infinite;
        }
        .background-slide {
            width: 20%;
            height: 100vh;
            float: left;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.7;
        }
        .bg1 { background: linear-gradient(45deg, #ff9a9e, #fad0c4); }
        .bg2 { background: linear-gradient(45deg, #a1c4fd, #c2e9fb); }
        .bg3 { background: linear-gradient(45deg, #ffecd2, #fcb69f); }
        .bg4 { background: linear-gradient(45deg, #84fab0, #8fd3f4); }
        .bg5 { background: linear-gradient(45deg, #d4fc79, #96e6a1); }
        .custom-bg { background-size: cover; background-position: center; }
        @keyframes scrollBackground {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }
        .game-container {
            position: relative;
            width: 100vw;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            padding-bottom: 80px;
        }
        .game-title {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: #ff4081;
            font-size: 28px;
            font-family: 'ZCOOL XiaoWei', sans-serif;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 10px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }
        .title-text {
            margin: 0 15px;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }
        .turn-hint {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 20px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #666;
            font-style: italic;
            border: 1px dashed #ff9eb5;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            padding: 15px 5%;
            background: transparent;
            margin: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .player-info {
            text-align: center;
            padding: 15px 20px;
            border-radius: 15px;
            min-width: 140px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .player1 {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border: 2px solid rgba(255, 154, 158, 0.5);
        }
        .player2 {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: 2px solid rgba(168, 237, 234, 0.5);
        }
        .player-info > div:first-child {
            font-size: 20px;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .player-info > div:nth-child(2) {
            font-size: 16px;
            background: rgba(255, 255, 255, 0.3);
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }
        .board-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px;
            min-height: 720px;
            margin: 20px 0;
            position: relative;
            gap: 20px;
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 3px;
            width: 720px;
            height: 720px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            position: relative;
            animation: boardPulse 3s infinite ease-in-out;
            backdrop-filter: blur(5px);
            background: radial-gradient(circle, rgba(255, 158, 181, 0.3) 0%, rgba(255, 255, 255, 0.2) 70%);
        }
        @keyframes boardPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
            50% { transform: scale(1.02); box-shadow: 0 12px 30px rgba(0,0,0,0.25); }
        }
        .path-line {
            position: absolute;
            background: linear-gradient(to right, rgba(255, 158, 181, 0.5), rgba(255, 255, 255, 0.3));
            border-radius: 5px;
            z-index: 0;
            transition: opacity 0.5s ease;
        }
        .cell {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 11px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            animation: cellAppear 0.5s ease-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.05)), var(--cell-bg);
        }
        @keyframes cellAppear {
            from { opacity: 0; transform: scale(0.8) rotate(-10deg); }
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        .cell:hover {
            transform: scale(1.08) rotate(5deg);
            box-shadow: 0 6px 15px rgba(0,0,0,0.25);
        }
        .cell-number {
            font-size: 9px;
            margin-bottom: 2px;
            background: rgba(0,0,0,0.3);
            padding: 2px 5px;
            border-radius: 10px;
            font-family: 'Dancing Script', cursive;
        }
        .cell-effect {
            font-size: 8px;
            text-align: center;
            line-height: 1.1;
            max-height: 40px;
            overflow: hidden;
            padding: 0 2px;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .cell.heart-shaped {
            position: relative;
            overflow: hidden;
        }
        .cell.heart-shaped::before {
            content: "";
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="rgba(255,255,255,0.2)" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/></svg>');
            background-size: 70%;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: -1;
        }
        .cell-glowing {
            box-shadow: 0 0 15px rgba(255, 158, 181, 0.8);
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(255, 158, 181, 0.6); }
            to { box-shadow: 0 0 20px rgba(255, 158, 181, 1); }
        }
        /* è§’è‰²æ‰®æ¼”æ ¼å­ç‰¹æ®Šæ ·å¼ */
        .cell-cosplay {
            --cell-bg: linear-gradient(45deg, #ff6b6b, #feca57) !important;
            animation: cosplayGlow 2s ease-in-out infinite alternate;
        }
        @keyframes cosplayGlow {
            from { box-shadow: 0 0 10px rgba(255, 107, 107, 0.6); }
            to { box-shadow: 0 0 25px rgba(254, 202, 87, 1); }
        }
        .cell-cosplay::after {
            content: "ğŸ­";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            opacity: 0.8;
        }
        /* æ™®é€šè‡ªå®šä¹‰è·³è½¬æ ¼å­æ ·å¼ */
        .cell-custom-jump {
            --cell-bg: linear-gradient(45deg, #2196F3, #03A9F4) !important;
            animation: customJumpGlow 2s ease-in-out infinite alternate;
        }
        @keyframes customJumpGlow {
            from { box-shadow: 0 0 10px rgba(33, 150, 243, 0.6); }
            to { box-shadow: 0 0 20px rgba(33, 150, 243, 1); }
        }
        .cell-custom-jump::after {
            content: "ğŸ”—";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.8;
        }
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255, 158, 181, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 2;
            animation: particleFloat 2s ease-out infinite;
        }
        @keyframes particleFloat {
            0% { transform: translate(0, 0); opacity: 0.8; }
            100% { transform: translate(calc(-50% + 20px), -20px); opacity: 0; }
        }
        .start { --cell-bg: linear-gradient(45deg, #4CAF50, #8BC34A); }
        .normal { --cell-bg: linear-gradient(45deg, #2196F3, #03A9F4); }
        .lucky { --cell-bg: linear-gradient(45deg, #FF9800, #FFC107); }
        .unlucky { --cell-bg: linear-gradient(45deg, #F44336, #E91E63); }
        .special { --cell-bg: linear-gradient(45deg, #9C27B0, #673AB7); }
        .end { --cell-bg: linear-gradient(45deg, #FFD700, #FFA500); }
        .player-piece {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            transition: all 0.5s ease;
            animation: pieceHover 2s ease-in-out infinite;
        }
        @keyframes pieceHover {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .piece-player1 {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            top: 5px;
            left: 5px;
        }
        .piece-player2 {
            background: linear-gradient(45deg, #a1c4fd, #c2e9fb);
            bottom: 5px;
            right: 5px;
        }
        .moving-piece {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            z-index: 20;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            transition: all 0.5s ease;
            animation: pieceHover 2s ease-in-out infinite;
        }
        .moving-player1 { background: linear-gradient(45deg, #ff9a9e, #fad0c4); }
        .moving-player2 { background: linear-gradient(45deg, #a1c4fd, #c2e9fb); }
        
        .dice-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }
        
        .player-dice-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.25);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            min-width: 150px;
            backdrop-filter: blur(5px);
            font-family: 'ZCOOL XiaoWei', sans-serif;
            transition: all 0.3s ease;
        }
        
        .player-dice-container h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .player1-dice h3 { color: #ff4081; }
        .player2-dice h3 { color: #2196F3; }
        
        .dice {
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            font-weight: bold;
            margin: 10px auto;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            font-family: 'Dancing Script', cursive;
        }
        
        .player1-dice .dice {
            border-color: #ff9eb5;
            color: #ff4081;
        }
        
        .player2-dice .dice {
            border-color: #a1c4fd;
            color: #2196F3;
        }
        
        .dice:hover {
            transform: scale(1.1);
            background: #f8f8f8;
        }
        
        .dice.rolling {
            animation: rollDice 0.5s ease-in-out;
        }
        
        @keyframes rollDice {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1.2); }
            75% { transform: rotate(270deg) scale(1.1); }
        }
        
        .roll-btn {
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        
        .player1-dice .roll-btn {
            background: linear-gradient(45deg, #ff9eb5, #ff6b95);
            box-shadow: 0 4px 15px rgba(255, 107, 149, 0.4);
        }
        
        .player1-dice .roll-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 149, 0.6);
        }
        
        .player2-dice .roll-btn {
            background: linear-gradient(45deg, #a1c4fd, #64b5f6);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        
        .player2-dice .roll-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.6);
        }
        
        .roll-btn:disabled {
            background: #ccc !important;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .game-status {
            position: relative;
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-width: 250px;
            margin: 20px auto;
            backdrop-filter: blur(5px);
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .status-item {
            margin: 10px 0;
            padding: 8px;
            background: rgba(248, 249, 250, 0.7);
            border-radius: 8px;
            font-size: 14px;
        }
        .effect-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            max-width: 400px;
            display: none;
            border: 2px solid #ff9eb5;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .close-popup {
            background: #ff6b95;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .close-popup:hover {
            background: #ff4081;
            transform: translateY(-2px);
        }
        .victory {
            animation: victory 2s ease-in-out infinite;
        }
        @keyframes victory {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }
        .bg-control, .jump-control, .music-control, .edit-control, .teleport-control {
            position: fixed;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 100;
            transition: all 0.3s;
        }
        .bg-control:hover, .jump-control:hover, .music-control:hover, .edit-control:hover, .teleport-control:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .bg-control { bottom: 70px; right: 20px; }
        .jump-control { bottom: 120px; right: 20px; }
        .music-control { bottom: 20px; right: 20px; }
        .edit-control { bottom: 170px; right: 20px; }
        .teleport-control { bottom: 220px; right: 20px; background: linear-gradient(135deg, #ffd700, #ffaa00); }
        .music-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .music-option {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .music-option:hover { background: #f0f0f0; }
        .music-option.selected {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        .music-upload {
            margin-top: 15px;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
        }
        .music-upload:hover { border-color: #2196f3; }
        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            width: 450px;
            max-height: 85vh;
            overflow-y: auto;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .settings-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .settings-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .settings-tab.active {
            border-bottom: 2px solid #007bff;
            color: #007bff;
        }
        .settings-content { display: none; }
        .settings-content.active { display: block; }
        .bg-option {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .bg-option:hover { background: #f0f0f0; }
        .bg-option.selected {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        .bg-upload {
            margin-top: 15px;
            padding: 10px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
        }
        .bg-upload:hover { border-color: #2196f3; }
        .jump-setting {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .jump-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .add-jump-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            width: 100%;
        }
        .remove-jump-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            margin-top: 5px;
            cursor: pointer;
        }
        
        /* è§’è‰²æ‰®æ¼”æ¸¸æˆé¢„è®¾æ ·å¼ */
        .cosplay-preset {
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #ff9eb5;
            border-radius: 10px;
            background: #fff5f7;
        }
        .cosplay-preset h4 {
            color: #ff4081;
            margin-bottom: 12px;
            font-size: 14px;
            text-align: center;
        }
        .cosplay-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-family: 'ZCOOL XiaoWei', sans-serif;
            transition: all 0.3s;
            text-align: left;
            padding-left: 15px;
        }
        .cosplay-btn:hover {
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .cosplay-bar { background: linear-gradient(90deg, #667eea, #764ba2); color: white; }
        .cosplay-police { background: linear-gradient(90deg, #f093fb, #f5576c); color: white; }
        .cosplay-siblings { background: linear-gradient(90deg, #4facfe, #00f2fe); color: white; }
        .cosplay-teacher { background: linear-gradient(90deg, #43e97b, #38f9d7); color: white; }
        
        /* è‡ªå®šä¹‰URLè·³è½¬è®¾ç½®åŒºåŸŸ */
        .custom-url-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f5f5f5;
        }
        .custom-url-section h4 {
            color: #2196F3;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .edit-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .edit-panel h3 {
            color: #ff4081;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
        }
        .cell-editor-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .cell-edit-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-size: 11px;
            position: relative;
        }
        .cell-edit-item:hover {
            border-color: #ff9eb5;
            transform: scale(1.05);
        }
        .cell-edit-item.selected {
            border-color: #ff4081;
            background: #ffe6f0;
            box-shadow: 0 0 10px rgba(255, 64, 129, 0.3);
        }
        .cell-edit-item.has-custom-jump {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        .cell-edit-item.has-cosplay {
            border-color: #ff6b6b;
            background: #fff0f0;
        }
        .cell-edit-number {
            font-weight: bold;
            color: #ff4081;
            margin-bottom: 3px;
            font-size: 13px;
        }
        .cell-edit-preview {
            font-size: 9px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .jump-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2196F3;
        }
        .cosplay-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff6b6b;
        }
        .cell-edit-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .cell-edit-form h4 {
            color: #ff4081;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
            font-size: 14px;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'ZCOOL XiaoWei', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #ff9eb5;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .cell-type-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .cell-type-option {
            padding: 6px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 11px;
        }
        .cell-type-option:hover {
            border-color: #ff9eb5;
        }
        .cell-type-option.selected {
            border-color: #ff4081;
            background: #ffe6f0;
            color: #ff4081;
        }
        .save-cell-btn {
            background: linear-gradient(45deg, #ff9eb5, #ff6b95);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        .save-cell-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 149, 0.4);
        }
        .edit-panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            transition: all 0.3s;
        }
        .edit-panel-close:hover {
            background: #ff4081;
            color: white;
        }
        
        .teleport-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            width: 400px;
            font-family: 'ZCOOL XiaoWei', sans-serif;
            border: 3px solid #ffd700;
        }
        .teleport-panel h3 {
            color: #ff4081;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .teleport-input-group {
            margin-bottom: 20px;
        }
        .teleport-input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
            font-size: 16px;
        }
        .teleport-input {
            width: 100%;
            padding: 15px;
            border: 3px solid #ffd700;
            border-radius: 12px;
            font-size: 20px;
            text-align: center;
            font-family: 'ZCOOL XiaoWei', sans-serif;
            transition: all 0.3s;
        }
        .teleport-input:focus {
            outline: none;
            border-color: #ff4081;
            box-shadow: 0 0 15px rgba(255, 64, 129, 0.3);
        }
        .teleport-input.error {
            border-color: #f44336;
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .teleport-error {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .teleport-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        .teleport-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'ZCOOL XiaoWei', sans-serif;
        }
        .teleport-confirm {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        .teleport-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6);
        }
        .teleport-confirm:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .teleport-cancel {
            background: #f0f0f0;
            color: #666;
        }
        .teleport-cancel:hover {
            background: #e0e0e0;
        }
        .teleport-hint {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 15px;
            font-style: italic;
        }
        
        .teleport-effect {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            z-index: 25;
            pointer-events: none;
        }
        
        @keyframes teleportFlash {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.3; filter: brightness(3); }
        }
        
        @keyframes teleportShrink {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(0.2) rotate(720deg); }
        }
        
        @keyframes teleportFly {
            0% { transform: scale(0.2) rotate(720deg); opacity: 0.8; }
            50% { transform: scale(0.1) rotate(1080deg); opacity: 0.4; }
            100% { transform: scale(0.2) rotate(1440deg); opacity: 0.8; }
        }
        
        @keyframes teleportExpand {
            0% { transform: scale(0.2) rotate(1440deg); }
            70% { transform: scale(1.3) rotate(1440deg); }
            100% { transform: scale(1) rotate(1440deg); }
        }
        
        @keyframes teleportRing {
            0% { transform: scale(0.5); opacity: 1; border-width: 3px; }
            100% { transform: scale(3); opacity: 0; border-width: 0px; }
        }
        
        .teleport-trail {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 24;
            animation: trailFade 0.6s ease-out forwards;
        }
        
        @keyframes trailFade {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(0.2); opacity: 0; }
        }
        
        .teleport-ring {
            position: absolute;
            border: 3px solid #ffd700;
            border-radius: 50%;
            pointer-events: none;
            z-index: 23;
            animation: teleportRing 0.8s ease-out forwards;
        }
        
        @media (max-width: 1400px) {
            .game-board { width: 630px; height: 630px; }
            .cell { width: 65px; height: 65px; font-size: 10px; }
        }
        @media (max-width: 1200px) {
            .game-board { width: 540px; height: 540px; }
            .cell { width: 55px; height: 55px; font-size: 9px; }
            .cell-effect { font-size: 7px; }
        }
        @media (max-width: 1024px) {
            .game-board { width: 450px; height: 450px; }
            .cell { width: 45px; height: 45px; font-size: 8px; }
            .player-piece, .moving-piece { width: 22px; height: 22px; font-size: 12px; }
            .board-container { flex-direction: column; }
            .dice-section { flex-direction: row; justify-content: center; width: 100%; }
        }
        @media (max-width: 768px) {
            .game-info { flex-direction: column; align-items: center; gap: 10px; }
            .player-info { width: 80%; max-width: 200px; }
            .game-board { width: 360px; height: 360px; }
            .cell { width: 36px; height: 36px; font-size: 7px; }
            .cell-number { font-size: 7px; }
            .cell-effect { font-size: 6px; }
            .edit-panel { width: 95%; max-width: 400px; }
            .cell-editor-grid { grid-template-columns: repeat(4, 1fr); }
            .dice-section { gap: 15px; }
            .player-dice-container { min-width: 120px; padding: 15px; }
            .teleport-panel { width: 90%; max-width: 350px; }
            .settings-panel { width: 95%; }
        }
        @media (max-width: 480px) {
            .game-board { width: 315px; height: 315px; }
            .cell { width: 32px; height: 32px; font-size: 6px; }
            .cell-number { font-size: 6px; }
            .cell-effect { font-size: 5px; }
            .edit-panel { width: 98%; }
            .cell-editor-grid { grid-template-columns: repeat(3, 1fr); }
            .dice { width: 60px; height: 60px; font-size: 28px; }
            .roll-btn { padding: 10px 18px; font-size: 14px; }
            .turn-hint { font-size: 12px; margin: 0 10px 10px; }
        }
        @media (max-width: 360px) {
            .game-board { width: 270px; height: 270px; }
            .cell { width: 27px; height: 27px; font-size: 5px; }
            .cell-number { font-size: 5px; }
            .cell-effect { font-size: 4px; }
        }
    </style>
</head>
<body>
    <div class="background-container" id="backgroundContainer">
        <div class="background-slide bg1"></div>
        <div class="background-slide bg2"></div>
        <div class="background-slide bg3"></div>
        <div class="background-slide bg4"></div>
        <div class="background-slide bg5"></div>
        <div class="background-slide bg1"></div>
        <div class="background-slide bg2"></div>
        <div class="background-slide bg3"></div>
        <div class="background-slide bg4"></div>
        <div class="background-slide bg5"></div>
    </div>
    <div class="scroll-container">
        <div class="game-container">
            <div class="game-title">
                <span class="title-text">æƒ…ä¾£é£è¡Œæ£‹å¤§å†’é™© - 81æ ¼æµªæ¼«ç‰ˆ</span>
            </div>
            
            <div class="turn-hint">
                ğŸ’• è¯·è‡ªè§‰è½®æµæŠ•æ·ï¼šåŒæ–¹å¯éšæ—¶ç‚¹å‡»éª°å­ï¼Œå»ºè®®åå•†å¥½é¡ºåºï¼Œé‡åˆ°æš‚åœæ•ˆæœæ—¶è¯·è‡ªè§‰è·³è¿‡è®©å¯¹æ–¹ç»§ç»­ ğŸ’•
            </div>
            
            <div class="game-info">
                <div class="player-info player1" id="player1Info">
                    <div>å¥³æœ‹å‹</div>
                    <div>ä½ç½®: <span id="player1Position">èµ·ç‚¹</span></div>
                </div>
                <div class="player-info player2" id="player2Info">
                    <div>ç”·æœ‹å‹</div>
                    <div>ä½ç½®: <span id="player2Position">èµ·ç‚¹</span></div>
                </div>
            </div>
            <div class="board-container">
                <div class="dice-section">
                    <div class="player-dice-container player1-dice" id="player1Dice">
                        <h3>å¥³æœ‹å‹</h3>
                        <div class="dice" id="dice1">?</div>
                        <button class="roll-btn" id="rollBtn1">æŠ•æ·éª°å­</button>
                    </div>
                </div>
                
                <div class="game-board" id="gameBoard"></div>
                
                <div class="dice-section">
                    <div class="player-dice-container player2-dice" id="player2Dice">
                        <h3>ç”·æœ‹å‹</h3>
                        <div class="dice" id="dice2">?</div>
                        <button class="roll-btn" id="rollBtn2">æŠ•æ·éª°å­</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="music-control" id="musicControl">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ff4081"><path d="M12 3v10.55A4 4 0 0 0 10 17a4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-2-3.45V7h4V3h-7z"/></svg>
    </div>
    <div class="bg-control" id="bgControl">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ff4081"><path d="M4 5v14h16V5H4zm0-2h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/></svg>
    </div>
    <div class="jump-control" id="jumpControl">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ff4081"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
    </div>
    <div class="edit-control" id="editControl" title="ç¼–è¾‘æ ¼å­å†…å®¹">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ff4081"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
    </div>
    <div class="teleport-control" id="teleportControl" title="ä¼ é€åŠŸèƒ½">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
    </div>
    <div class="music-panel" id="musicPanel">
        <h3 style="margin-bottom: 15px; text-align: center;">é€‰æ‹©èƒŒæ™¯éŸ³ä¹</h3>
        <div class="music-option" onclick="selectMusic('none', this)">æ— éŸ³ä¹</div>
        <div class="music-option" onclick="selectMusic('romantic1', this)">æµªæ¼«éŸ³ä¹ 1</div>
        <div class="music-option" onclick="selectMusic('romantic2', this)">æµªæ¼«éŸ³ä¹ 2</div>
        <div class="music-option" onclick="selectMusic('funny1', this)">è½»æ¾éŸ³ä¹ 1</div>
        <div class="music-upload" id="musicUpload">
            <input type="file" id="musicFileInput" accept="audio/*" style="display: none;">
            <label for="musicFileInput" style="cursor: pointer;">ä¸Šä¼ æœ¬åœ°éŸ³ä¹</label>
        </div>
        <button class="close-popup" style="margin-top: 15px; width: 100%;" onclick="closePopup()">å…³é—­</button>
    </div>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-tabs">
            <div class="settings-tab active" data-tab="bg">èƒŒæ™¯è®¾ç½®</div>
            <div class="settings-tab" data-tab="jump">è·³è½¬è®¾ç½®</div>
        </div>
        <div class="settings-content active" id="bgSettings">
            <h3 style="margin-bottom: 15px; text-align: center;">é€‰æ‹©èƒŒæ™¯</h3>
            <div class="bg-option selected" onclick="changeBackground('gradient1', this)">æ¸å˜èƒŒæ™¯ 1</div>
            <div class="bg-option" onclick="changeBackground('gradient2', this)">æ¸å˜èƒŒæ™¯ 2</div>
            <div class="bg-option" onclick="changeBackground('gradient3', this)">æ¸å˜èƒŒæ™¯ 3</div>
            <div class="bg-option" onclick="changeBackground('image1', this)">çˆ±å¿ƒèƒŒæ™¯</div>
            <div class="bg-option" onclick="changeBackground('image2', this)">æ˜Ÿç©ºèƒŒæ™¯</div>
            <div class="bg-upload" id="bgUpload">
                <input type="file" id="bgFileInput" accept="image/*" style="display: none;">
                <label for="bgFileInput" style="cursor: pointer;">ä¸Šä¼ è‡ªå®šä¹‰èƒŒæ™¯</label>
            </div>
        </div>
        <div class="settings-content" id="jumpSettings">
            <h3 style="margin-bottom: 15px; text-align: center;">æ ¼å­è·³è½¬è®¾ç½®</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px; text-align: center;">è®¾ç½®ç‰¹å®šæ ¼å­è·³è½¬åˆ°æŒ‡å®šé¡µé¢ï¼ˆ1-81ï¼‰</p>
            
            <!-- è§’è‰²æ‰®æ¼”æ¸¸æˆé¢„è®¾ -->
            <div class="cosplay-preset">
                <h4>ğŸ­ å¿«é€Ÿè®¾ç½®è§’è‰²æ‰®æ¼”æ¸¸æˆ</h4>
                <button class="cosplay-btn cosplay-bar" onclick="quickSetCosplay('bar')">ğŸ· é…’å§é‚‚é€…</button>
                <button class="cosplay-btn cosplay-police" onclick="quickSetCosplay('police')">ğŸ‘® è­¦å¯Ÿä¸å°å·</button>
                <button class="cosplay-btn cosplay-siblings" onclick="quickSetCosplay('siblings')">ğŸ‘« å…„å¦¹æƒ…æ·±</button>
                <button class="cosplay-btn cosplay-teacher" onclick="quickSetCosplay('teacher')">ğŸ“š å¸ˆç”Ÿæƒ…ç¼˜</button>
            </div>
            
            <!-- è‡ªå®šä¹‰URLè·³è½¬ -->
            <div class="custom-url-section">
                <h4>ğŸ”— è‡ªå®šä¹‰URLè·³è½¬</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">å¯ä»¥è®¾ç½®è·³è½¬åˆ°ä»»æ„é¡µé¢ï¼Œå¦‚ new_index.html æˆ–å…¶ä»–ç½‘å€</p>
                <div id="jumpSettingsList"></div>
                <button class="add-jump-btn" onclick="addJumpSetting()">+ æ·»åŠ è‡ªå®šä¹‰è·³è½¬</button>
            </div>
        </div>
        <button class="close-popup" style="margin-top: 15px; width: 100%;" onclick="closePopup()">å…³é—­</button>
    </div>
    <div class="edit-panel" id="editPanel">
        <button class="edit-panel-close" onclick="closeEditPanel()">Ã—</button>
        <h3>ç¼–è¾‘æ ¼å­å†…å®¹</h3>
        <div class="cell-editor-grid" id="cellEditorGrid"></div>
        <div class="cell-edit-form" id="cellEditForm" style="display: none;">
            <h4>ç¼–è¾‘ç¬¬ <span id="editingCellNumber">1</span> æ ¼</h4>
            <div class="form-group">
                <label>æ ¼å­ç±»å‹</label>
                <div class="cell-type-options">
                    <div class="cell-type-option" data-type="start">èµ·ç‚¹</div>
                    <div class="cell-type-option" data-type="normal">æ™®é€š</div>
                    <div class="cell-type-option" data-type="lucky">å¹¸è¿</div>
                    <div class="cell-type-option" data-type="unlucky">å€’éœ‰</div>
                    <div class="cell-type-option" data-type="special">ç‰¹æ®Š</div>
                    <div class="cell-type-option" data-type="end">ç»ˆç‚¹</div>
                </div>
            </div>
            <div class="form-group">
                <label>æ˜¾ç¤ºæ–‡å­—ï¼ˆçŸ­æ ‡é¢˜ï¼‰</label>
                <input type="text" id="cellEditText" placeholder="å¦‚ï¼šçœŸå¿ƒè¯ã€å¤§å†’é™©ã€å–é…’ç­‰" maxlength="10">
            </div>
            <div class="form-group">
                <label>è¯¦ç»†æ•ˆæœæè¿°</label>
                <textarea id="cellEditEffect" placeholder="è¾“å…¥å…·ä½“çš„æ¸¸æˆè§„åˆ™æˆ–æƒ©ç½šå†…å®¹..."></textarea>
            </div>
            <button class="save-cell-btn" onclick="saveCellEdit()">ä¿å­˜ä¿®æ”¹</button>
        </div>
    </div>
    <div class="teleport-panel" id="teleportPanel">
        <h3>âœ¨ ç¬é—´ä¼ é€ âœ¨</h3>
        <div class="teleport-input-group">
            <label>é€‰æ‹©è¦ä¼ é€çš„ç©å®¶ï¼š</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button id="teleportPlayer1Btn" style="flex: 1; padding: 10px; border: 3px solid #ff9eb5; border-radius: 10px; background: white; cursor: pointer; font-family: 'ZCOOL XiaoWei'; font-size: 16px; transition: all 0.3s;" onclick="selectTeleportPlayer(1)">å¥³æœ‹å‹</button>
                <button id="teleportPlayer2Btn" style="flex: 1; padding: 10px; border: 3px solid #a1c4fd; border-radius: 10px; background: white; cursor: pointer; font-family: 'ZCOOL XiaoWei'; font-size: 16px; transition: all 0.3s;" onclick="selectTeleportPlayer(2)">ç”·æœ‹å‹</button>
            </div>
        </div>
        <div class="teleport-input-group">
            <label>è¾“å…¥ç›®æ ‡æ ¼å­ç¼–å·ï¼ˆ1-81ï¼‰ï¼š</label>
            <input type="number" class="teleport-input" id="teleportInput" min="1" max="81" placeholder="ä¾‹å¦‚ï¼š40">
            <div class="teleport-error" id="teleportError">è¯·è¾“å…¥1-81ä¹‹é—´çš„æ•°å­—</div>
        </div>
        <div class="teleport-hint">ğŸ’« è¾“å…¥1å›åˆ°èµ·ç‚¹ï¼Œ81ç›´è¾¾ç»ˆç‚¹</div>
        <div class="teleport-buttons">
            <button class="teleport-btn teleport-cancel" onclick="closeTeleportPanel()">å–æ¶ˆ</button>
            <button class="teleport-btn teleport-confirm" id="teleportConfirmBtn" onclick="executeTeleport()">å¼€å§‹ä¼ é€</button>
        </div>
    </div>
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="effect-popup" id="effectPopup">
        <h3 id="popupTitle"></h3>
        <p id="popupContent"></p>
        <button class="close-popup">ç¡®å®š</button>
    </div>
    <audio id="bgm" loop></audio>
    <script>
        // æ¸¸æˆé…ç½® - 81æ ¼ç‰ˆæœ¬
        const TOTAL_CELLS = 81;
        const GRID_SIZE = 9; // 9x9ç½‘æ ¼
        
        let player1Position = 0;
        let player2Position = 0;
        let gameEnded = false;
        let isMoving = false;
        let musicEnabled = false;
        let currentEditingCell = 0;
        let selectedTeleportPlayer = 1;
        
        // å››ä¸ªè§’è‰²æ‰®æ¼”æ¸¸æˆé…ç½®
        const cosplayGames = {
            'bar': {
                filename: 'cosChance Encounter at a Bar.html',
                name: 'é…’å§é‚‚é€…',
                icon: 'ğŸ·',
                description: 'åœ¨é…’å§å¶é‡çš„æµªæ¼«æ•…äº‹'
            },
            'police': {
                filename: 'cosPolice and thieves.html',
                name: 'è­¦å¯Ÿä¸å°å·',
                icon: 'ğŸ‘®',
                description: 'æ­£ä¹‰ä¸é‚ªæ¶çš„è¿½é€æ¸¸æˆ'
            },
            'siblings': {
                filename: 'cosSiblings.html',
                name: 'å…„å¦¹æƒ…æ·±',
                icon: 'ğŸ‘«',
                description: 'å…„å¦¹ä¹‹é—´çš„æ¸©é¦¨äº’åŠ¨'
            },
            'teacher': {
                filename: 'cosTeacher and student.html',
                name: 'å¸ˆç”Ÿæƒ…ç¼˜',
                icon: 'ğŸ“š',
                description: 'è¯¾å ‚ä¸Šçš„ç‰¹åˆ«è¾…å¯¼'
            }
        };
        
        // å­˜å‚¨è§’è‰²æ‰®æ¼”æ¸¸æˆè·³è½¬è®¾ç½®ï¼ˆæ ¼å­ç´¢å¼• -> æ¸¸æˆkeyï¼‰
        let cosplayJumps = {};
        
        // å­˜å‚¨æ™®é€šè‡ªå®šä¹‰URLè·³è½¬ï¼ˆæ ¼å­ç´¢å¼• -> URLï¼‰
        let customJumps = {};
        
        const musicOptions = {
            'romantic1': 'https://assets.mixkit.co/music/preview/mixkit-serene-view-443.mp3',
            'romantic2': 'https://assets.mixkit.co/music/preview/mixkit-a-very-happy-christmas-897.mp3',
            'funny1': 'https://assets.mixkit.co/music/preview/mixkit-happy-times-158.mp3'
        };
        
        // èƒŒæ™¯é€‰é¡¹
        const backgroundOptions = {
            'gradient1': [
                'linear-gradient(45deg, #ff9a9e, #fad0c4)',
                'linear-gradient(45deg, #a1c4fd, #c2e9fb)',
                'linear-gradient(45deg, #ffecd2, #fcb69f)',
                'linear-gradient(45deg, #84fab0, #8fd3f4)',
                'linear-gradient(45deg, #d4fc79, #96e6a1)'
            ],
            'gradient2': [
                'linear-gradient(45deg, #ff6b6b, #4ecdc4)',
                'linear-gradient(45deg, #556270, #ff6b6b)',
                'linear-gradient(45deg, #834d9b, #d04ed6)',
                'linear-gradient(45deg, #4b6cb7, #182848)',
                'linear-gradient(45deg, #f46b45, #eea849)'
            ],
            'gradient3': [
                'linear-gradient(45deg, #5f2c82, #49a09d)',
                'linear-gradient(45deg, #ff5e62, #ff9966)',
                'linear-gradient(45deg, #7f00ff, #e100ff)',
                'linear-gradient(45deg, #00c9ff, #92fe9d)',
                'linear-gradient(45deg, #f7971e, #ffd200)'
            ],
            'image1': [
                'url(https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1519699047748-de8e457a634e?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1516726817505-f5ed825624d8?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)'
            ],
            'image2': [
                'url(https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1465101162946-4377e57745c3?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1446776877081-d282a0f896e2?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)',
                'url(https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80)'
            ],
            'custom': []
        };
        
        // ç”Ÿæˆ9x9è›‡å½¢æ£‹ç›˜å¸ƒå±€
        function generateBoardLayout() {
            const layout = [];
            let index = 0;
            for (let row = 0; row < GRID_SIZE; row++) {
                const rowArr = [];
                if (row % 2 === 0) {
                    // å¶æ•°è¡Œï¼šä»å·¦åˆ°å³
                    for (let col = 0; col < GRID_SIZE; col++) {
                        rowArr.push(index++);
                    }
                } else {
                    // å¥‡æ•°è¡Œï¼šä»å³åˆ°å·¦
                    for (let col = GRID_SIZE - 1; col >= 0; col--) {
                        rowArr.push(index++);
                    }
                }
                layout.push(rowArr);
            }
            return layout;
        }
        
        const boardLayout = generateBoardLayout();
        
        // åˆå§‹åŒ–81ä¸ªæ ¼å­çš„æ•ˆæœ
        function initializeCellEffects() {
            const effects = [];
            
            // èµ·ç‚¹
            effects.push({ type: 'start', text: 'èµ·ç‚¹', effect: 'æ¸¸æˆå¼€å§‹ï¼Œç¥ä½ ä»¬ç©å¾—å¼€å¿ƒï¼' });
            
            // ä¸­é—´79ä¸ªæ ¼å­
            const types = ['normal', 'lucky', 'unlucky', 'special'];
            const texts = {
                'normal': ['æ™®é€š', 'å‰è¿›', 'ä¼‘æ¯', 'èŠå¤©', 'å¯¹è§†'],
                'lucky': ['å¹¸è¿', 'å¥–åŠ±', 'å…ç½š', 'ç¿»å€', 'æƒŠå–œ'],
                'unlucky': ['å€’éœ‰', 'å–é…’', 'åé€€', 'è·³è¿‡', 'æƒ©ç½š'],
                'special': ['çœŸå¿ƒè¯', 'å¤§å†’é™©', 'äº²å¯†', 'æŒ‘æˆ˜', 'ç§˜å¯†']
            };
            
            for (let i = 1; i < TOTAL_CELLS - 1; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const textList = texts[type];
                const text = textList[Math.floor(Math.random() * textList.length)];
                
                effects.push({
                    type: type,
                    text: text,
                    effect: `${text} - æ ¹æ®æ¸¸æˆè§„åˆ™æ‰§è¡Œç›¸åº”åŠ¨ä½œ`
                });
            }
            
            // ç»ˆç‚¹
            effects.push({ type: 'end', text: 'ç»ˆç‚¹', effect: 'æ­å–œåˆ°è¾¾ç»ˆç‚¹ï¼ä»Šæ™šä½ è¯´äº†ç®—~' });
            
            return effects;
        }
        
        let cellEffects = initializeCellEffects();
        
        function createFallingPetals() {
            const container = document.querySelector('.background-container');
            for (let i = 0; i < 10; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDelay = Math.random() * 15 + 's';
                petal.style.opacity = Math.random() * 0.5 + 0.3;
                petal.style.transform = `scale(${Math.random() * 0.5 + 0.5})`;
                container.appendChild(petal);
            }
        }
        
        function createPathLines() {
            const board = document.getElementById('gameBoard');
            // æ¸…é™¤æ—§çš„è·¯å¾„çº¿
            const oldSvg = board.querySelector('svg');
            if (oldSvg) oldSvg.remove();
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.zIndex = '0';
            board.appendChild(svg);
            
            for (let i = 0; i < TOTAL_CELLS - 1; i++) {
                const currentCell = document.getElementById(`cell-${i}`);
                const nextCell = document.getElementById(`cell-${i + 1}`);
                if (!currentCell || !nextCell) continue;
                
                const currentRect = currentCell.getBoundingClientRect();
                const nextRect = nextCell.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', currentRect.left + currentRect.width / 2 - boardRect.left);
                line.setAttribute('y1', currentRect.top + currentRect.height / 2 - boardRect.top);
                line.setAttribute('x2', nextRect.left + nextRect.width / 2 - boardRect.left);
                line.setAttribute('y2', nextRect.top + nextRect.height / 2 - boardRect.top);
                line.setAttribute('stroke', 'rgba(255, 158, 181, 0.5)');
                line.setAttribute('stroke-width', '3');
                svg.appendChild(line);
            }
        }
        
        function addParticleEffect(cell) {
            if (cell.classList.contains('special') || cell.classList.contains('lucky')) {
                for (let i = 0; i < 3; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${Math.random() * 60}px`;
                    particle.style.top = `${Math.random() * 60}px`;
                    particle.style.animationDelay = `${Math.random() * 2}s`;
                    cell.appendChild(particle);
                }
            }
        }
        
        function beautifyCells() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                if (Math.random() > 0.5) {
                    cell.classList.add('heart-shaped');
                }
                const cellIndex = parseInt(cell.dataset.index);
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯è§’è‰²æ‰®æ¼”æ ¼å­
                if (cosplayJumps[cellIndex]) {
                    cell.classList.add('cell-cosplay');
                }
                // æ£€æŸ¥æ˜¯å¦æ˜¯æ™®é€šè‡ªå®šä¹‰è·³è½¬æ ¼å­
                else if (customJumps[cellIndex]) {
                    cell.classList.add('cell-custom-jump');
                }
                else if (cellEffects[cellIndex].type === 'special' || cellEffects[cellIndex].type === 'lucky') {
                    cell.classList.add('cell-glowing');
                    addParticleEffect(cell);
                }
            });
        }
        
        function toggleMusicPanel() {
            const musicPanel = document.getElementById('musicPanel');
            const popupOverlay = document.getElementById('popupOverlay');
            musicPanel.style.display = musicPanel.style.display === 'block' ? 'none' : 'block';
            popupOverlay.style.display = musicPanel.style.display;
        }
        
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('effectPopup').style.display = 'none';
            document.getElementById('musicPanel').style.display = 'none';
            document.getElementById('settingsPanel').style.display = 'none';
        }
        
        function selectMusic(musicType, element) {
            const bgm = document.getElementById('bgm');
            if (musicType === 'none') {
                bgm.pause();
                bgm.src = '';
                musicEnabled = false;
                localStorage.setItem('flyingChessMusic', 'none');
            } else if (musicOptions[musicType]) {
                bgm.src = musicOptions[musicType];
                bgm.play().catch(e => console.log("éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                musicEnabled = true;
                localStorage.setItem('flyingChessMusic', musicType);
            }
            document.querySelectorAll('.music-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            closePopup();
        }
        
        function handleMusicUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const bgm = document.getElementById('bgm');
                    bgm.src = e.target.result;
                    bgm.play().catch(e => console.log("éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                    musicEnabled = true;
                    localStorage.setItem('flyingChessCustomMusic', e.target.result);
                    localStorage.setItem('flyingChessMusic', 'custom');
                    document.querySelectorAll('.music-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                };
                reader.readAsDataURL(file);
            }
        }
        
        function loadSavedMusic() {
            const savedMusic = localStorage.getItem('flyingChessMusic');
            const customMusic = localStorage.getItem('flyingChessCustomMusic');
            const bgm = document.getElementById('bgm');
            if (savedMusic === 'custom' && customMusic) {
                bgm.src = customMusic;
                musicEnabled = true;
            } else if (savedMusic && musicOptions[savedMusic]) {
                bgm.src = musicOptions[savedMusic];
                musicEnabled = true;
                document.querySelectorAll('.music-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.textContent.trim() === getMusicOptionName(savedMusic)) {
                        option.classList.add('selected');
                    }
                });
            }
            document.addEventListener('click', function playMusic() {
                if (musicEnabled && bgm.src) {
                    bgm.play().catch(e => console.log("éŸ³ä¹æ’­æ”¾å¤±è´¥:", e));
                }
                document.removeEventListener('click', playMusic);
            });
        }
        
        function getMusicOptionName(key) {
            const names = {
                'romantic1': 'æµªæ¼«éŸ³ä¹ 1',
                'romantic2': 'æµªæ¼«éŸ³ä¹ 2',
                'funny1': 'è½»æ¾éŸ³ä¹ 1'
            };
            return names[key] || '';
        }
        
        function toggleSettings(type) {
            const settingsPanel = document.getElementById('settingsPanel');
            const popupOverlay = document.getElementById('popupOverlay');
            settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
            popupOverlay.style.display = settingsPanel.style.display;
            if (type) {
                switchSettingsTab(type);
            }
        }
        
        function switchSettingsTab(tabName) {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
            });
            document.querySelectorAll('.settings-content').forEach(content => {
                content.classList.toggle('active', content.id === tabName + 'Settings');
            });
        }
        
        function changeBackground(type, element) {
            const slides = document.querySelectorAll('.background-slide');
            const options = document.querySelectorAll('.bg-option');
            options.forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            if (type === 'custom') return;
            if (backgroundOptions[type]) {
                for (let i = 0; i < slides.length; i++) {
                    const slideIndex = i % 5;
                    slides[i].style.background = backgroundOptions[type][slideIndex];
                    slides[i].style.backgroundSize = 'cover';
                    slides[i].style.backgroundPosition = 'center';
                    slides[i].className = 'background-slide';
                }
            }
            localStorage.setItem('flyingChessBackground', type);
        }
        
        function handleBgUpload() {
            const fileInput = document.getElementById('bgFileInput');
            fileInput.click();
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const slides = document.querySelectorAll('.background-slide');
                        for (let i = 0; i < slides.length; i++) {
                            slides[i].style.background = `url(${event.target.result})`;
                            slides[i].style.backgroundSize = 'cover';
                            slides[i].style.backgroundPosition = 'center';
                            slides[i].className = 'background-slide custom-bg';
                        }
                        localStorage.setItem('flyingChessCustomBg', event.target.result);
                        localStorage.setItem('flyingChessBackground', 'custom');
                        document.querySelectorAll('.bg-option').forEach(option => {
                            option.classList.remove('selected');
                        });
                    };
                    reader.readAsDataURL(file);
                }
            };
        }
        
        function loadSavedBackground() {
            const savedBg = localStorage.getItem('flyingChessBackground');
            const customBg = localStorage.getItem('flyingChessCustomBg');
            if (savedBg === 'custom' && customBg) {
                const slides = document.querySelectorAll('.background-slide');
                for (let i = 0; i < slides.length; i++) {
                    slides[i].style.background = `url(${customBg})`;
                    slides[i].style.backgroundSize = 'cover';
                    slides[i].style.backgroundPosition = 'center';
                    slides[i].className = 'background-slide custom-bg';
                }
            } else if (savedBg && backgroundOptions[savedBg]) {
                const options = document.querySelectorAll('.bg-option');
                options.forEach(option => {
                    option.classList.remove('selected');
                    if (option.textContent.trim() === getBgOptionName(savedBg)) {
                        option.classList.add('selected');
                    }
                });
                const slides = document.querySelectorAll('.background-slide');
                for (let i = 0; i < slides.length; i++) {
                    const slideIndex = i % 5;
                    slides[i].style.background = backgroundOptions[savedBg][slideIndex];
                    slides[i].style.backgroundSize = 'cover';
                    slides[i].style.backgroundPosition = 'center';
                }
            }
        }
        
        function getBgOptionName(key) {
            const names = {
                'gradient1': 'æ¸å˜èƒŒæ™¯ 1',
                'gradient2': 'æ¸å˜èƒŒæ™¯ 2',
                'gradient3': 'æ¸å˜èƒŒæ™¯ 3',
                'image1': 'çˆ±å¿ƒèƒŒæ™¯',
                'image2': 'æ˜Ÿç©ºèƒŒæ™¯'
            };
            return names[key] || '';
        }
        
        // ==================== è·³è½¬è®¾ç½®åŠŸèƒ½ï¼ˆä¿ç•™åŸæœ‰+æ–°å¢ï¼‰ ====================
        
        function loadJumpSettings() {
            // åŠ è½½æ™®é€šè‡ªå®šä¹‰è·³è½¬
            const savedJumps = localStorage.getItem('flyingChessJumps_v2');
            if (savedJumps) {
                customJumps = JSON.parse(savedJumps);
            }
            // åŠ è½½è§’è‰²æ‰®æ¼”æ¸¸æˆè·³è½¬
            const savedCosplay = localStorage.getItem('flyingChessCosplay_v2');
            if (savedCosplay) {
                cosplayJumps = JSON.parse(savedCosplay);
            }
        }
        
        function saveJumpSettings() {
            localStorage.setItem('flyingChessJumps_v2', JSON.stringify(customJumps));
            localStorage.setItem('flyingChessCosplay_v2', JSON.stringify(cosplayJumps));
        }
        
        function renderJumpSettings() {
            const container = document.getElementById('jumpSettingsList');
            container.innerHTML = '';
            
            // æ˜¾ç¤ºæ™®é€šè‡ªå®šä¹‰è·³è½¬
            for (const [cellIndex, url] of Object.entries(customJumps)) {
                const settingDiv = document.createElement('div');
                settingDiv.className = 'jump-setting';
                settingDiv.style.borderLeft = '4px solid #2196F3';
                settingDiv.innerHTML = `
                    <div style="color: #2196F3; font-weight: bold;">ğŸ”— æ ¼å­ ${parseInt(cellIndex) + 1}</div>
                    <input type="text" class="jump-input" value="${url}" 
                        onchange="updateJumpUrl(${cellIndex}, this.value)" placeholder="è·³è½¬URL">
                    <button class="remove-jump-btn" onclick="removeJumpSetting(${cellIndex})">åˆ é™¤</button>
                `;
                container.appendChild(settingDiv);
            }
            
            // æ˜¾ç¤ºè§’è‰²æ‰®æ¼”æ¸¸æˆè·³è½¬
            for (const [cellIndex, gameKey] of Object.entries(cosplayJumps)) {
                const game = cosplayGames[gameKey];
                const settingDiv = document.createElement('div');
                settingDiv.className = 'jump-setting';
                settingDiv.style.borderLeft = '4px solid #ff6b6b';
                settingDiv.innerHTML = `
                    <div style="color: #ff6b6b; font-weight: bold;">ğŸ­ æ ¼å­ ${parseInt(cellIndex) + 1} â†’ ${game.icon} ${game.name}</div>
                    <div style="font-size: 12px; color: #666; margin: 5px 0;">${game.description}</div>
                    <button class="remove-jump-btn" onclick="removeCosplayJump(${cellIndex})">åˆ é™¤è§’è‰²æ‰®æ¼”</button>
                `;
                container.appendChild(settingDiv);
            }
        }
        
        // å¿«é€Ÿè®¾ç½®è§’è‰²æ‰®æ¼”æ¸¸æˆåˆ°æŒ‡å®šæ ¼å­ï¼ˆæ–°å¢ï¼‰
        function quickSetCosplay(gameKey) {
            const game = cosplayGames[gameKey];
            const cellNum = prompt(`è¯·è¾“å…¥è¦å°†"${game.name}"è®¾ç½®åˆ°å“ªä¸ªæ ¼å­ï¼Ÿ\n\n${game.description}\n\nè¯·è¾“å…¥1-${TOTAL_CELLS}ä¹‹é—´çš„æ•°å­—ï¼š`);
            
            if (cellNum === null) return; // ç”¨æˆ·å–æ¶ˆ
            
            const cellIndex = parseInt(cellNum) - 1;
            
            if (isNaN(cellIndex) || cellIndex < 0 || cellIndex >= TOTAL_CELLS) {
                alert(`è¯·è¾“å…¥æœ‰æ•ˆçš„æ ¼å­ç¼–å·ï¼ˆ1-${TOTAL_CELLS}ï¼‰`);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²è¢«å ç”¨
            if (cosplayJumps[cellIndex] || customJumps[cellIndex]) {
                const existing = cosplayJumps[cellIndex] ? 
                    cosplayGames[cosplayJumps[cellIndex]].name : 
                    'è‡ªå®šä¹‰é“¾æ¥';
                if (!confirm(`æ ¼å­${cellNum}å·²è®¾ç½®è·³è½¬åˆ°"${existing}"ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ`)) {
                    return;
                }
                // åˆ é™¤æ—§çš„
                delete cosplayJumps[cellIndex];
                delete customJumps[cellIndex];
            }
            
            // è®¾ç½®æ–°çš„è§’è‰²æ‰®æ¼”æ¸¸æˆ
            cosplayJumps[cellIndex] = gameKey;
            
            // æ›´æ–°æ ¼å­æ•ˆæœ
            cellEffects[cellIndex] = {
                type: 'special',
                text: game.name,
                effect: `ğŸ­ è§’è‰²æ‰®æ¼”ï¼š${game.description}\n\nç‚¹å‡»ç¡®å®šåå°†è·³è½¬åˆ°æ¸¸æˆé¡µé¢`
            };
            
            saveJumpSettings();
            localStorage.setItem('flyingChessCellEffects_v2', JSON.stringify(cellEffects));
            renderJumpSettings();
            createBoard();
            
            alert(`âœ… å·²å°†"${game.name}"è®¾ç½®åˆ°ç¬¬${cellNum}æ ¼ï¼\n\nå½“ç©å®¶è½åœ¨æ­¤æ ¼å­æ—¶ï¼Œå°†è‡ªåŠ¨è§¦å‘è§’è‰²æ‰®æ¼”æ¸¸æˆè·³è½¬ã€‚`);
        }
        
        function removeCosplayJump(cellIndex) {
            delete cosplayJumps[cellIndex];
            saveJumpSettings();
            renderJumpSettings();
            createBoard();
        }
        
        // ä¿ç•™åŸæœ‰çš„è‡ªå®šä¹‰è·³è½¬åŠŸèƒ½
        function addJumpSetting() {
            const cellNum = prompt(`è¯·è¾“å…¥è¦è®¾ç½®è·³è½¬çš„æ ¼å­ç¼–å·ï¼ˆ1-${TOTAL_CELLS}ï¼‰ï¼š`);
            if (cellNum === null) return;
            
            const cellIndex = parseInt(cellNum) - 1;
            if (isNaN(cellIndex) || cellIndex < 0 || cellIndex >= TOTAL_CELLS) {
                alert(`è¯·è¾“å…¥æœ‰æ•ˆçš„æ ¼å­ç¼–å·ï¼ˆ1-${TOTAL_CELLS}ï¼‰`);
                return;
            }
            
            if (cosplayJumps[cellIndex] || customJumps[cellIndex]) {
                const existing = cosplayJumps[cellIndex] ? 
                    cosplayGames[cosplayJumps[cellIndex]].name : 
                    'è‡ªå®šä¹‰é“¾æ¥';
                if (!confirm(`æ ¼å­${cellNum}å·²è®¾ç½®è·³è½¬åˆ°"${existing}"ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ`)) {
                    return;
            }
                delete cosplayJumps[cellIndex];
                delete customJumps[cellIndex];
            }
            
            const url = prompt('è¯·è¾“å…¥è·³è½¬URLï¼š\n\nä¾‹å¦‚ï¼šnew_index.html æˆ– https://example.com', 'new_index.html');
            if (url === null || url.trim() === '') return;
            
            customJumps[cellIndex] = url.trim();
            saveJumpSettings();
            renderJumpSettings();
            createBoard();
            
            alert(`âœ… å·²å°†è‡ªå®šä¹‰è·³è½¬è®¾ç½®åˆ°ç¬¬${cellNum}æ ¼ï¼\n\nè·³è½¬ç›®æ ‡ï¼š${url}`);
        }
        
        function updateJumpUrl(cellIndex, newUrl) {
            customJumps[cellIndex] = newUrl;
            saveJumpSettings();
        }
        
        function removeJumpSetting(cellIndex) {
            delete customJumps[cellIndex];
            saveJumpSettings();
            renderJumpSettings();
            createBoard();
        }
        
        function createBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cellIndex = boardLayout[row][col];
                    const cell = document.createElement('div');
                    
                    // ç¡®å®šæ ¼å­ç±»å‹æ ·å¼
                    let cellClass = 'cell';
                    if (cosplayJumps[cellIndex]) {
                        cellClass += ' cell-cosplay';
                    } else if (customJumps[cellIndex]) {
                        cellClass += ' cell-custom-jump';
                    } else {
                        cellClass += ' ' + cellEffects[cellIndex].type;
                    }
                    
                    cell.className = cellClass;
                    cell.id = `cell-${cellIndex}`;
                    cell.dataset.index = cellIndex;
                    
                    // ç¡®å®šæ˜¾ç¤ºæ–‡å­—
                    let displayText;
                    if (cosplayJumps[cellIndex]) {
                        displayText = cosplayGames[cosplayJumps[cellIndex]].name;
                    } else if (customJumps[cellIndex]) {
                        displayText = 'è·³è½¬';
                    } else {
                        displayText = cellEffects[cellIndex].text;
                    }
                    
                    cell.innerHTML = `
                        <div class="cell-number">${cellIndex + 1}</div>
                        <div class="cell-effect">${displayText}</div>
                    `;
                    cell.addEventListener('click', () => showCellEffect(cellIndex));
                    board.appendChild(cell);
                }
            }
            beautifyCells();
            // å»¶è¿Ÿåˆ›å»ºè·¯å¾„çº¿ï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
            setTimeout(createPathLines, 100);
            updatePlayerPieces();
        }
        
        function showCellEffect(cellIndex) {
            const effect = cellEffects[cellIndex];
            const cosplayGame = cosplayJumps[cellIndex];
            const customUrl = customJumps[cellIndex];
            
            if (cosplayGame) {
                const game = cosplayGames[cosplayGame];
                document.getElementById('popupTitle').textContent = `ğŸ­ ç¬¬${cellIndex + 1}æ ¼ - ${game.name}`;
                document.getElementById('popupContent').innerHTML = 
                    `<strong>${game.description}</strong><br><br>` +
                    `ğŸ® æ¸¸æˆæ–‡ä»¶ï¼š${game.filename}<br>` +
                    `ğŸ· è§’è‰²æ‰®æ¼”æ¨¡å¼<br><br>` +
                    `<em>è½åœ¨æ­¤æ ¼å­å°†è‡ªåŠ¨è·³è½¬åˆ°æ¸¸æˆé¡µé¢</em>`;
            } else if (customUrl) {
                document.getElementById('popupTitle').textContent = `ğŸ”— ç¬¬${cellIndex + 1}æ ¼ - è‡ªå®šä¹‰è·³è½¬`;
                document.getElementById('popupContent').innerHTML = 
                    `<strong>è·³è½¬ç›®æ ‡ï¼š</strong><br>${customUrl}<br><br>` +
                    `<em>è½åœ¨æ­¤æ ¼å­å°†æç¤ºæ˜¯å¦è·³è½¬åˆ°è¯¥é“¾æ¥</em>`;
            } else {
                document.getElementById('popupTitle').textContent = `ç¬¬${cellIndex + 1}æ ¼ - ${effect.text}`;
                document.getElementById('popupContent').textContent = effect.effect || 'æš‚æ— æè¿°';
            }
            
            document.getElementById('popupOverlay').style.display = 'block';
            document.getElementById('effectPopup').style.display = 'block';
        }
        
        function rollDice(playerNum) {
            if (gameEnded || isMoving) return;
            
            const diceElement = document.getElementById(`dice${playerNum}`);
            const rollBtn = document.getElementById(`rollBtn${playerNum}`);
            
            rollBtn.disabled = true;
            diceElement.classList.add('rolling');
            
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                diceElement.textContent = Math.floor(Math.random() * 6) + 1;
                rollCount++;
                if (rollCount > 8) {
                    clearInterval(rollInterval);
                    const result = Math.floor(Math.random() * 6) + 1;
                    diceElement.textContent = result;
                    diceElement.classList.remove('rolling');
                    movePlayer(result, playerNum);
                }
            }, 100);
        }
        
        function getCellPosition(cellIndex, playerNum) {
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    if (boardLayout[row][col] === cellIndex) {
                        const cell = document.getElementById(`cell-${cellIndex}`);
                        if (cell) {
                            const rect = cell.getBoundingClientRect();
                            const boardRect = document.getElementById('gameBoard').getBoundingClientRect();
                            return {
                                x: rect.left - boardRect.left + (playerNum === 1 ? 5 : 40),
                                y: rect.top - boardRect.top + (playerNum === 1 ? 5 : 40)
                            };
                        }
                    }
                }
            }
            console.warn(`Cell ${cellIndex} not found`);
            return { x: 0, y: 0 };
        }
        
        function movePlayer(steps, playerNum) {
            const oldPosition = playerNum === 1 ? player1Position : player2Position;
            let newPosition = oldPosition + steps;
            if (newPosition >= TOTAL_CELLS - 1) {
                newPosition = TOTAL_CELLS - 1;
            }
            
            movePlayerStepByStep(oldPosition, newPosition, steps, playerNum);
        }
        
        function movePlayerStepByStep(oldPosition, newPosition, steps, playerNum) {
            isMoving = true;
            
            const movingPiece = document.createElement('div');
            movingPiece.className = `moving-piece moving-player${playerNum}`;
            movingPiece.innerHTML = playerNum === 1 ? 'å¥³' : 'ç”·';
            
            const startPos = getCellPosition(oldPosition, playerNum);
            movingPiece.style.position = 'absolute';
            movingPiece.style.left = `${startPos.x}px`;
            movingPiece.style.top = `${startPos.y}px`;
            document.getElementById('gameBoard').appendChild(movingPiece);
            
            const currentPlayerPiece = document.querySelector(`.piece-player${playerNum}`);
            if (currentPlayerPiece) {
                currentPlayerPiece.style.visibility = 'hidden';
            }
            
            let currentStep = 0;
            const moveInterval = setInterval(() => {
                if (currentStep >= steps) {
                    clearInterval(moveInterval);
                    movingPiece.remove();
                    
                    if (currentPlayerPiece) {
                        currentPlayerPiece.style.visibility = 'visible';
                    }
                    
                    if (playerNum === 1) {
                        player1Position = newPosition;
                    } else {
                        player2Position = newPosition;
                    }
                    
                    updatePlayerPieces();
                    updatePlayerInfo();
                    handleLanding(newPosition, playerNum);
                    
                    document.getElementById(`rollBtn${playerNum}`).disabled = false;
                    
                    if (newPosition >= TOTAL_CELLS - 1) {
                        setTimeout(() => {
                            endGame(playerNum);
                            isMoving = false;
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            isMoving = false;
                        }, 1000);
                    }
                    return;
                }
                const nextPosition = oldPosition + currentStep + 1;
                const nextPos = getCellPosition(nextPosition, playerNum);
                movingPiece.style.left = `${nextPos.x}px`;
                movingPiece.style.top = `${nextPos.y}px`;
                currentStep++;
            }, 300);
        }
        
        function handleLanding(cellIndex, playerNum) {
            // ä¼˜å…ˆæ£€æŸ¥è§’è‰²æ‰®æ¼”æ¸¸æˆè·³è½¬ï¼ˆæ–°å¢ï¼‰
            if (cosplayJumps[cellIndex]) {
                const gameKey = cosplayJumps[cellIndex];
                const game = cosplayGames[gameKey];
                
                // æ˜¾ç¤ºç‰¹æ•ˆå¼¹çª—
                document.getElementById('popupTitle').innerHTML = `ğŸ­ è§¦å‘è§’è‰²æ‰®æ¼”ï¼`;
                document.getElementById('popupContent').innerHTML = 
                    `<strong style="font-size: 18px; color: #ff6b6b;">${game.name}</strong><br><br>` +
                    `${game.description}<br><br>` +
                    `å³å°†è·³è½¬åˆ°è§’è‰²æ‰®æ¼”æ¸¸æˆ...`;
                
                document.getElementById('popupOverlay').style.display = 'block';
                document.getElementById('effectPopup').style.display = 'block';
                
                // 3ç§’åè‡ªåŠ¨è·³è½¬
                setTimeout(() => {
                    window.location.href = game.filename;
                }, 2500);
                
                return;
            }
            
            // æ£€æŸ¥æ™®é€šè‡ªå®šä¹‰è·³è½¬ï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰
            if (customJumps[cellIndex]) {
                const shouldJump = confirm(`ç¬¬${cellIndex + 1}æ ¼è®¾ç½®äº†è·³è½¬é“¾æ¥ï¼\n\næ˜¯å¦è·³è½¬åˆ°: ${customJumps[cellIndex]}?\n\nç‚¹å‡»"ç¡®å®š"ç«‹å³è·³è½¬ï¼Œç‚¹å‡»"å–æ¶ˆ"ç•™åœ¨å½“å‰æ ¼å­æŸ¥çœ‹æ•ˆæœ`);
                if (shouldJump) {
                    window.location.href = customJumps[cellIndex];
                    return;
                }
            }
            
            // æ˜¾ç¤ºæ™®é€šæ ¼å­æ•ˆæœ
            showCellEffect(cellIndex);
        }
        
        function updatePlayerPieces() {
            document.querySelectorAll('.player-piece').forEach(piece => piece.remove());
            if (player1Position >= 0) {
                const cell1 = document.getElementById(`cell-${player1Position}`);
                if (cell1) {
                    const piece1 = document.createElement('div');
                    piece1.className = 'player-piece piece-player1';
                    piece1.innerHTML = 'å¥³';
                    if (player1Position === player2Position) {
                        piece1.style.left = '2px';
                        piece1.style.top = '2px';
                    }
                    cell1.appendChild(piece1);
                }
            }
            if (player2Position >= 0) {
                const cell2 = document.getElementById(`cell-${player2Position}`);
                if (cell2) {
                    const piece2 = document.createElement('div');
                    piece2.className = 'player-piece piece-player2';
                    piece2.innerHTML = 'ç”·';
                    if (player1Position === player2Position) {
                        piece2.style.right = '2px';
                        piece2.style.bottom = '2px';
                    }
                    cell2.appendChild(piece2);
                }
            }
        }
        
        function updatePlayerInfo() {
            document.getElementById('player1Position').textContent = 
                player1Position === 0 ? 'èµ·ç‚¹' : 
                player1Position >= TOTAL_CELLS - 1 ? 'ç»ˆç‚¹' : `ç¬¬${player1Position + 1}æ ¼`;
            document.getElementById('player2Position').textContent = 
                player2Position === 0 ? 'èµ·ç‚¹' : 
                player2Position >= TOTAL_CELLS - 1 ? 'ç»ˆç‚¹' : `ç¬¬${player2Position + 1}æ ¼`;
        }
        
        function endGame(winner) {
            gameEnded = true;
            const winnerName = winner === 1 ? 'å¥³æœ‹å‹' : 'ç”·æœ‹å‹';
            document.getElementById('popupTitle').textContent = 'æ¸¸æˆç»“æŸï¼';
            document.getElementById('popupContent').textContent = `${winnerName} èµ¢å¾—äº†ä»Šæ™šçš„ä¸»å®°æƒï¼ğŸ‰`;
            document.getElementById('popupOverlay').style.display = 'block';
            document.getElementById('effectPopup').style.display = 'block';
            const winnerPiece = document.querySelector(`.piece-player${winner}`);
            if (winnerPiece) {
                winnerPiece.classList.add('victory');
            }
            document.getElementById('rollBtn1').disabled = true;
            document.getElementById('rollBtn2').disabled = true;
        }
        
        function openEditPanel() {
            document.getElementById('popupOverlay').style.display = 'block';
            document.getElementById('editPanel').style.display = 'block';
            renderCellEditorGrid();
        }
        
        function closeEditPanel() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('editPanel').style.display = 'none';
            document.getElementById('cellEditForm').style.display = 'none';
        }
        
        function renderCellEditorGrid() {
            const grid = document.getElementById('cellEditorGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < TOTAL_CELLS; i++) {
                const item = document.createElement('div');
                item.className = 'cell-edit-item';
                
                if (i === currentEditingCell) {
                    item.classList.add('selected');
                }
                if (customJumps[i]) {
                    item.classList.add('has-custom-jump');
                }
                if (cosplayJumps[i]) {
                    item.classList.add('has-cosplay');
                }
                
                const effect = cellEffects[i];
                const cosplayGame = cosplayJumps[i];
                
                let displayText = effect.text || 'æœªè®¾ç½®';
                if (cosplayGame) {
                    displayText = cosplayGames[cosplayGame].name;
                } else if (customJumps[i]) {
                    displayText = 'ğŸ”— è·³è½¬';
                }
                
                let indicator = '';
                if (customJumps[i]) {
                    indicator = '<div class="jump-indicator"></div>';
                } else if (cosplayJumps[i]) {
                    indicator = '<div class="cosplay-indicator"></div>';
                }
                
                item.innerHTML = `
                    <div class="cell-edit-number">${i + 1}</div>
                    <div class="cell-edit-preview">${displayText}</div>
                    ${indicator}
                `;
                
                item.onclick = () => selectCellToEdit(i);
                grid.appendChild(item);
            }
        }
        
        function selectCellToEdit(index) {
            currentEditingCell = index;
            const effect = cellEffects[index];
            
            document.querySelectorAll('.cell-edit-item').forEach((item, idx) => {
                item.classList.toggle('selected', idx === index);
            });
            
            document.getElementById('cellEditForm').style.display = 'block';
            document.getElementById('editingCellNumber').textContent = index + 1;
            
            document.getElementById('cellEditText').value = effect.text || '';
            document.getElementById('cellEditEffect').value = effect.effect || '';
            
            document.querySelectorAll('.cell-type-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.type === effect.type);
            });
            
            document.getElementById('cellEditForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('cell-type-option')) {
                document.querySelectorAll('.cell-type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                e.target.classList.add('selected');
            }
        });
        
        function saveCellEdit() {
            const text = document.getElementById('cellEditText').value.trim();
            const effect = document.getElementById('cellEditEffect').value.trim();
            const type = document.querySelector('.cell-type-option.selected')?.dataset.type || 'normal';
            
            cellEffects[currentEditingCell] = {
                type: type,
                text: text || 'æ™®é€š',
                effect: effect
            };
            
            localStorage.setItem('flyingChessCellEffects_v2', JSON.stringify(cellEffects));
            createBoard();
            renderCellEditorGrid();
            selectCellToEdit(currentEditingCell);
            alert(`ç¬¬ ${currentEditingCell + 1} æ ¼ä¿å­˜æˆåŠŸï¼`);
        }
        
        function loadSavedCellEffects() {
            const saved = localStorage.getItem('flyingChessCellEffects_v2');
            if (saved) {
                cellEffects = JSON.parse(saved);
            }
        }
        
        // ä¼ é€åŠŸèƒ½
        function openTeleportPanel() {
            if (gameEnded) {
                alert('æ¸¸æˆå·²ç»“æŸï¼Œæ— æ³•ä¼ é€');
                return;
            }
            if (isMoving) {
                alert('æ£‹å­æ­£åœ¨ç§»åŠ¨ä¸­ï¼Œè¯·ç¨åå†è¯•');
                return;
            }
            
            document.getElementById('popupOverlay').style.display = 'block';
            document.getElementById('teleportPanel').style.display = 'block';
            
            document.getElementById('teleportInput').value = '';
            document.getElementById('teleportError').style.display = 'none';
            document.getElementById('teleportInput').classList.remove('error');
            
            selectTeleportPlayer(1);
        }
        
        function closeTeleportPanel() {
            document.getElementById('popupOverlay').style.display = 'none';
            document.getElementById('teleportPanel').style.display = 'none';
        }
        
        function selectTeleportPlayer(playerNum) {
            selectedTeleportPlayer = playerNum;
            const btn1 = document.getElementById('teleportPlayer1Btn');
            const btn2 = document.getElementById('teleportPlayer2Btn');
            
            if (playerNum === 1) {
                btn1.style.background = '#ff9eb5';
                btn1.style.color = 'white';
                btn1.style.borderColor = '#ff4081';
                btn2.style.background = 'white';
                btn2.style.color = '#666';
                btn2.style.borderColor = '#a1c4fd';
            } else {
                btn2.style.background = '#a1c4fd';
                btn2.style.color = 'white';
                btn2.style.borderColor = '#2196F3';
                btn1.style.background = 'white';
                btn1.style.color = '#666';
                btn1.style.borderColor = '#ff9eb5';
            }
        }
        
        function executeTeleport() {
            const input = document.getElementById('teleportInput');
            const errorDiv = document.getElementById('teleportError');
            const targetNum = parseInt(input.value);
            
            if (isNaN(targetNum) || targetNum < 1 || targetNum > TOTAL_CELLS) {
                input.classList.add('error');
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    input.classList.remove('error');
                }, 500);
                return;
            }
            
            const targetIndex = targetNum - 1;
            const currentPos = selectedTeleportPlayer === 1 ? player1Position : player2Position;
            
            if (currentPos === targetIndex) {
                alert('å·²ç»åœ¨è¯¥ä½ç½®äº†ï¼');
                return;
            }
            
            closeTeleportPanel();
            performTeleportAnimation(currentPos, targetIndex, selectedTeleportPlayer);
        }
        
        function performTeleportAnimation(fromIndex, toIndex, playerNum) {
            isMoving = true;
            
            const board = document.getElementById('gameBoard');
            const fromPos = getCellPosition(fromIndex, playerNum);
            const toPos = getCellPosition(toIndex, playerNum);
            
            const originalPiece = document.querySelector(`.piece-player${playerNum}`);
            if (originalPiece) {
                originalPiece.style.visibility = 'hidden';
            }
            
            const teleportPiece = document.createElement('div');
            teleportPiece.className = `teleport-effect moving-player${playerNum}`;
            teleportPiece.innerHTML = playerNum === 1 ? 'å¥³' : 'ç”·';
            teleportPiece.style.left = `${fromPos.x}px`;
            teleportPiece.style.top = `${fromPos.y}px`;
            teleportPiece.style.display = 'flex';
            teleportPiece.style.justifyContent = 'center';
            teleportPiece.style.alignItems = 'center';
            teleportPiece.style.fontSize = '14px';
            teleportPiece.style.color = 'white';
            teleportPiece.style.fontWeight = 'bold';
            teleportPiece.style.textShadow = '1px 1px 2px rgba(0,0,0,0.5)';
            board.appendChild(teleportPiece);
            
            teleportPiece.style.animation = 'teleportFlash 0.2s ease-in-out 2';
            
            setTimeout(() => {
                teleportPiece.style.animation = 'teleportShrink 0.2s ease-in forwards';
                createTeleportTrail(fromPos.x + 14, fromPos.y + 14, playerNum === 1 ? '#ff9eb5' : '#a1c4fd');
                
                setTimeout(() => {
                    teleportPiece.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    teleportPiece.style.left = `${toPos.x}px`;
                    teleportPiece.style.top = `${toPos.y}px`;
                    teleportPiece.style.animation = 'teleportFly 0.3s ease-in-out forwards';
                    
                    let trailCount = 0;
                    const trailInterval = setInterval(() => {
                        const progress = trailCount / 5;
                        const currentX = fromPos.x + (toPos.x - fromPos.x) * progress + 14;
                        const currentY = fromPos.y + (toPos.y - fromPos.y) * progress + 14;
                        createTeleportTrail(currentX, currentY, playerNum === 1 ? '#ff9eb5' : '#a1c4fd');
                        trailCount++;
                        if (trailCount >= 5) clearInterval(trailInterval);
                    }, 60);
                    
                    setTimeout(() => {
                        teleportPiece.style.animation = 'teleportExpand 0.2s ease-out forwards';
                        createTeleportRing(toPos.x + 14, toPos.y + 14);
                        
                        setTimeout(() => {
                            teleportPiece.remove();
                            
                            if (playerNum === 1) {
                                player1Position = toIndex;
                            } else {
                                player2Position = toIndex;
                            }
                            
                            updatePlayerPieces();
                            updatePlayerInfo();
                            handleLanding(toIndex, playerNum);
                            
                            if (toIndex >= TOTAL_CELLS - 1) {
                                setTimeout(() => {
                                    endGame(playerNum);
                                    isMoving = false;
                                }, 500);
                            } else {
                                isMoving = false;
                            }
                            
                        }, 200);
                    }, 300);
                }, 200);
            }, 400);
        }
        
        function createTeleportTrail(x, y, color) {
            const board = document.getElementById('gameBoard');
            const trail = document.createElement('div');
            trail.className = 'teleport-trail';
            trail.style.left = `${x - 4}px`;
            trail.style.top = `${y - 4}px`;
            trail.style.background = color;
            trail.style.boxShadow = `0 0 10px ${color}`;
            board.appendChild(trail);
            
            setTimeout(() => trail.remove(), 600);
        }
        
        function createTeleportRing(x, y) {
            const board = document.getElementById('gameBoard');
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const ring = document.createElement('div');
                    ring.className = 'teleport-ring';
                    ring.style.left = `${x - 25}px`;
                    ring.style.top = `${y - 25}px`;
                    ring.style.width = '50px';
                    ring.style.height = '50px';
                    ring.style.borderColor = i % 2 === 0 ? '#ffd700' : '#ff69b4';
                    board.appendChild(ring);
                    setTimeout(() => ring.remove(), 800);
                }, i * 100);
            }
        }
        
        document.getElementById('teleportInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeTeleport();
            }
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadSavedCellEffects();
            loadJumpSettings();
            createBoard();
            updatePlayerInfo();
            createFallingPetals();
            loadSavedMusic();
            loadSavedBackground();
            renderJumpSettings();
            
            document.getElementById('rollBtn1').addEventListener('click', () => rollDice(1));
            document.getElementById('dice1').addEventListener('click', () => rollDice(1));
            document.getElementById('rollBtn2').addEventListener('click', () => rollDice(2));
            document.getElementById('dice2').addEventListener('click', () => rollDice(2));
            
            document.getElementById('teleportControl').addEventListener('click', openTeleportPanel);
            
            document.querySelectorAll('.close-popup').forEach(btn => btn.addEventListener('click', closePopup));
            document.getElementById('musicControl').addEventListener('click', toggleMusicPanel);
            document.getElementById('bgControl').addEventListener('click', () => toggleSettings('bg'));
            document.getElementById('jumpControl').addEventListener('click', () => toggleSettings('jump'));
            document.getElementById('bgUpload').addEventListener('click', handleBgUpload);
            document.getElementById('musicFileInput').addEventListener('change', handleMusicUpload);
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchSettingsTab(tab.getAttribute('data-tab'));
                });
            });
            
            document.getElementById('editControl').addEventListener('click', openEditPanel);
        }
        
        window.onload = initGame;
    </script>
</body>
</html>
